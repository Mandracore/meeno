<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>public/javascripts/views/browser-body.js - Meeno source code documentation</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="Meeno source code documentation"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.2.5</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/BrowserBodyFilterView.html">BrowserBodyFilterView</a></li>
            
                <li><a href="../classes/BrowserBodyNoteView.html">BrowserBodyNoteView</a></li>
            
                <li><a href="../classes/BrowserBodyObjectView.html">BrowserBodyObjectView</a></li>
            
                <li><a href="../classes/BrowserBodyTagView.html">BrowserBodyTagView</a></li>
            
                <li><a href="../classes/BrowserBodyTaskView.html">BrowserBodyTaskView</a></li>
            
                <li><a href="../classes/BrowserBodyView.html">BrowserBodyView</a></li>
            
                <li><a href="../classes/BrowserTabView.html">BrowserTabView</a></li>
            
                <li><a href="../classes/BrowserView.html">BrowserView</a></li>
            
                <li><a href="../classes/EditorBodyView.html">EditorBodyView</a></li>
            
                <li><a href="../classes/EditorTabView.html">EditorTabView</a></li>
            
                <li><a href="../classes/EditorView.html">EditorView</a></li>
            
                <li><a href="../classes/MainView.html">MainView</a></li>
            
                <li><a href="../classes/Note.html">Note</a></li>
            
                <li><a href="../classes/NoteFilter.html">NoteFilter</a></li>
            
                <li><a href="../classes/NoteFilters.html">NoteFilters</a></li>
            
                <li><a href="../classes/Notes.html">Notes</a></li>
            
                <li><a href="../classes/NoteTag.html">NoteTag</a></li>
            
                <li><a href="../classes/NoteTask.html">NoteTask</a></li>
            
                <li><a href="../classes/ObjectFilter.html">ObjectFilter</a></li>
            
                <li><a href="../classes/ObjectFilters.html">ObjectFilters</a></li>
            
                <li><a href="../classes/TagFilter.html">TagFilter</a></li>
            
                <li><a href="../classes/TagFilters.html">TagFilters</a></li>
            
                <li><a href="../classes/Tags.html">Tags</a></li>
            
                <li><a href="../classes/Task.html">Task</a></li>
            
                <li><a href="../classes/TaskFilter.html">TaskFilter</a></li>
            
                <li><a href="../classes/TaskFilters.html">TaskFilters</a></li>
            
                <li><a href="../classes/Tasks.html">Tasks</a></li>
            
                <li><a href="../classes/TaskTag.html">TaskTag</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: public/javascripts/views/browser-body.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
define ([
		&#x27;jquery.ui&#x27;,
		&#x27;underscore&#x27;,
		&#x27;backbone&#x27;,
		&#x27;temp&#x27;,
		&#x27;channel&#x27;,
		&#x27;models/filter&#x27;,
		&#x27;views/browser-body-note&#x27;,
		&#x27;views/browser-body-task&#x27;,
		&#x27;views/browser-body-tag&#x27;,
		&#x27;views/browser-body-filter&#x27;,
	], function ($, _, Backbone, temp, channel, Filter, BrowserBodyNoteView, BrowserBodyTaskView, BrowserBodyTagView, BrowserBodyFilterView) {

		/**
		 * This class will be used to support the main view of the object browser.
		 * From here, the user will be able to browse notes, tags and tasks, using filters and sorting out results.
		 * It controls the creation of several subviews, like {{#crossLink &quot;BrowserBodyTagView&quot;}}{{/crossLink}},
		 * {{#crossLink &quot;BrowserBodyFilterView&quot;}}{{/crossLink}},...
		 * 
		 * @class BrowserBodyView
		 * @constructor
		 * @param {Object} parent Holds a reference to the mother browser view
		 * @extends Backbone.View
		 */
		var BrowserBodyView = Backbone.View.extend ({

			// Initialize the view
			// =============================================================================
			// That view will be binded to a pre-existing piece of DOM
			// (&quot;el&quot; is passed directly to the class constructor : see http://backbonejs.org/#View-constructor)
			// It also explains why we don&#x27;t need a render function
			// It&#x27;s meant to be used for both Help and Browse tabs, which explains some functions won&#x27;t be used in some cases

			// ###Setup the view&#x27;s DOM events
			events: {
				// Search-related events
				&#x27;click .filter li&#x27;                                 : &#x27;toggleObject&#x27;,
				&#x27;keyup .search&#x27;                                    : &#x27;searchText&#x27;,
				&#x27;click .objectButtons span&#x27;                        : &#x27;searchObjectRemove&#x27;,
				&#x27;click .filter-editor button.save&#x27;                 : &#x27;filterSaveStep1&#x27;,
				&#x27;click .filter-editor button.saveConfirm&#x27;          : &#x27;filterSaveStep2&#x27;,
				&#x27;click .filter-editor button.delete&#x27;               : &#x27;filterDelete&#x27;,
				// Action-related events
				&#x27;click .actions-contextual .delete&#x27;                : &#x27;actionDeleteToggle&#x27;,
				&#x27;click .actions-contextual-selection .select-all&#x27;  : &#x27;actionSelectAll&#x27;,
				&#x27;click .actions-contextual-selection .unselect-all&#x27;: &#x27;actionUnSelectAll&#x27;,
				&#x27;click .actions-contextual-trigger button&#x27;         : &#x27;actionExecute&#x27;,
			},

			// ###Setup the view
			initialize: function() {
				var self = this;

				this.children = {
					&quot;notes&quot;      : [],
					&quot;tags&quot;       : [],
					&quot;tasks&quot;      : [],
					&quot;noteFilters&quot;: [],
					&quot;tagFilters&quot; : [],
					&quot;taskFilters&quot;: []
				};

				// this.filters stores the filters that actually filter the displayed collections
				// they can be cloned for saving
				this.filters = {
					&quot;noteFilter&quot;: new Filter.Note(),
					&quot;taskFilter&quot;: new Filter.Task(),
					&quot;tagFilter&quot; : new Filter.Tag()
				};

				this.listenTo(temp.coll.notes, &#x27;add remove change:title add:tagLinks&#x27;, function () {this.renderCollection(&quot;notes&quot;);});
				this.listenTo(temp.coll.tags, &#x27;add remove change:label&#x27;, function () {
					this.renderCollection(&quot;notes&quot;);
					this.renderCollection(&quot;tags&quot;);});
				this.listenTo(temp.coll.tasks, &#x27;add remove change:label&#x27;, function () {this.renderCollection(&quot;tasks&quot;);});

				this.listenTo(temp.coll.noteFilters, &#x27;reset add remove&#x27;, function () {this.renderFilterCollection(&quot;noteFilters&quot;);});
				this.listenTo(temp.coll.taskFilters, &#x27;reset add remove&#x27;, function () {this.renderFilterCollection(&quot;taskFilters&quot;);});
				this.listenTo(temp.coll.tagFilters, &#x27;reset add remove&#x27;, function () {this.renderFilterCollection(&quot;tagFilters&quot;);});
				this.listenTo(temp.coll.noteFilters, &#x27;change add remove&#x27;, function () {this.refreshFilterControls(&quot;note&quot;);});
				this.listenTo(temp.coll.taskFilters, &#x27;change add remove&#x27;, function () {this.refreshFilterControls(&quot;task&quot;);});
				this.listenTo(temp.coll.tagFilters, &#x27;change add remove&#x27;, function () {this.refreshFilterControls(&quot;tag&quot;);});

				this.listenTo(this.filters.noteFilter, &#x27;change add:tags remove:tags add:tasks remove:tasks&#x27;, function () {
					this.renderCollection(&quot;notes&quot;);
					this.refreshFilterControls(&quot;note&quot;);
					this.renderFilterInSuperInput(&quot;noteFilter&quot;); });
				this.listenTo(this.filters.taskFilter, &#x27;change add:tags remove:tags&#x27;, function () {
					this.renderCollection(&quot;tasks&quot;);
					this.refreshFilterControls(&quot;task&quot;);
					this.renderFilterInSuperInput(&quot;taskFilter&quot;);});
				this.listenTo(this.filters.tagFilter, &#x27;change&#x27;, function () {
					this.renderCollection(&quot;tags&quot;);
					this.refreshFilterControls(&quot;tag&quot;);
					this.renderFilterInSuperInput(&quot;tagFilter&quot;);});

				this.listenTo(channel, &#x27;keyboard:tag&#x27;, function () {this.searchOpenAutocomplete(&quot;tags&quot;);});
				this.listenTo(channel, &#x27;keyboard:task&#x27;, function () {this.searchOpenAutocomplete(&quot;tasks&quot;);});
				this.listenTo(channel, &#x27;keyboard:entity&#x27;, function () {this.searchOpenAutocomplete(&quot;entities&quot;);});
				this.listenTo(channel, &#x27;keyboard:escape&#x27;, function () {this.searchCloseAutocomplete(&quot;escape&quot;);});
				this.listenTo(channel, &#x27;keyboard:backspace&#x27;, function () {this.searchCloseAutocomplete(&quot;backspace&quot;);});

				this.listenTo(channel, &#x27;browser:notes:reSyncSelectors&#x27;, function () {this.reSyncSelectors(&quot;notes&quot;);});
				this.listenTo(channel, &#x27;browser:tags:reSyncSelectors&#x27;, function () {this.reSyncSelectors(&quot;tags&quot;);});
				this.listenTo(channel, &#x27;browser:taks:reSyncSelectors&#x27;, function () {this.reSyncSelectors(&quot;tasks&quot;);});

				// Deactivated for testing purposes only
				this.refreshFilterControls(&quot;note&quot;);
				this.refreshFilterControls(&quot;task&quot;);
				this.refreshFilterControls(&quot;tag&quot;);
			},

			// Navigation in the browser
			// =============================================================================
			// To display the browser itself and then to choose which objects to display

			/**
			 * Makes the browser visible
			 *
			 * @method toggle
			 */
			toggle: function() {
				// First, deactivate the other tabs&#x27; content
				$(&quot;#tabs&quot;).children().each(function(i,child){
					$(child).removeClass(&quot;selected&quot;);
				});
				// Then activate this one
				this.$el.addClass(&#x27;selected&#x27;);
			},

			/**
			 * Displays the adequate subsection of the browser (notes, tags or tasks) when the user clicks
			 * on the right button (class &#x60;.filter li&#x60;).
			 *
			 * @method toggleObject
			 * @param {event} event Backbone event
			 */
			toggleObject : function (event) {
				var objectClass = $(event.target).hasClass(&quot;notes&quot;) ? &quot;notes&quot; : ($(event.target).hasClass(&quot;tags&quot;) ? &quot;tags&quot; : &quot;tasks&quot;);
				// First, the command
				this.$el.find(&quot;.filter ul&quot;).children().each(function(i,child){
					$(child).removeClass(&quot;selected&quot;);
				});
				this.$el.find(&quot;.filter li.&quot;+objectClass).addClass(&#x27;selected&#x27;);
				// Then, the contents
				this.$el.children(&quot;.listobjects&quot;).each(function(i,child){
					$(child).removeClass(&quot;selected&quot;);
				});
				this.$el.find(&quot;.listobjects.&quot;+objectClass).addClass(&#x27;selected&#x27;);
			},

			// Mass actions
			// =============================================================================
			// Series of methods that allow for selecting several objects and operating an 
			// action on them (delete, tag, move,...)

			/**
			 * Manages the buttons &quot;select all&quot; and &quot;unselect all&quot;. Will be called every time an object
			 * is selected or unseleted to make sure that the right buttons are displayed
			 * 
			 * @method actionSelectorsUpdate
			 */
			actionSelectorsUpdate : function (collName) {
				var $listObjects = this.$(&quot;.listobjects.&quot;+collName);

				var countUnselected = $listObjects.find(&quot;span.checkbox.icon-check-empty&quot;).length;
				if (countUnselected === 0) { // &quot;Unselect all&quot; only
					$listObjects.find(&quot;.actions-contextual-selection .select-all&quot;).hide();
					$listObjects.find(&quot;.actions-contextual-selection .unselect-all&quot;).show();
				} else {
					var countSelected = $listObjects.find(&quot;span.checkbox.icon-check&quot;).length;
					if (countSelected === 0) { // &quot;Select all&quot; only
						$listObjects.find(&quot;.actions-contextual-selection .select-all&quot;).show();
						$listObjects.find(&quot;.actions-contextual-selection .unselect-all&quot;).hide();
					} else { // &quot;Select all&quot; and &quot;Unselect all&quot;
						$listObjects.find(&quot;.actions-contextual-selection .select-all&quot;).show();
						$listObjects.find(&quot;.actions-contextual-selection .unselect-all&quot;).show();
					}
				}
			},

			/**
			 * Should select all objects
			 * 
			 * @method actionSelectAll
			 */
			actionSelectAll: function (event) {
				var $listObjects = $(event.target).closest(&quot;.listobjects&quot;);
				var collName     = $listObjects.hasClass(&quot;notes&quot;) ? &quot;notes&quot; : ($listObjects.hasClass(&quot;tags&quot;) ? &quot;tags&quot; : &quot;tasks&quot;);

				channel.trigger(&quot;browser:actions:select:all:&quot;+collName); // To display checked boxes
				this.actionSelectorsUpdate(collName); // To update selectors
			},

			/**
			 * Should unselect all objects
			 * 
			 * @method actionUnSelectAll
			 */
			actionUnSelectAll: function (event) {
				var $listObjects = $(event.target).closest(&quot;.listobjects&quot;);
				var collName     = $listObjects.hasClass(&quot;notes&quot;) ? &quot;notes&quot; : ($listObjects.hasClass(&quot;tags&quot;) ? &quot;tags&quot; : &quot;tasks&quot;);

				channel.trigger(&quot;browser:actions:select:none:&quot;+collName); // To display checked boxes
				this.actionSelectorsUpdate(collName); // To update selectors
			},

			/**
			 * Displays or hides the controls necessary to select/unselect all objects, delete them,...
			 * Throws an event to make subviews display their checkboxes
			 * 
			 * @method actionDeleteToggle
			 */
			actionDeleteToggle: function (event) {
				var $listObjects = $(event.target).closest(&quot;.listobjects&quot;);
				var collName     = $listObjects.hasClass(&quot;notes&quot;) ? &quot;notes&quot; : ($listObjects.hasClass(&quot;tags&quot;) ? &quot;tags&quot; : &quot;tasks&quot;);

				$listObjects.find(&quot;.actions-contextual .action&quot;).toggle();
				$listObjects.find(&quot;.actions-contextual .cancel&quot;).toggle();
				$listObjects.find(&quot;.actions-contextual-trigger&quot;).toggle();
				$listObjects.find(&quot;.actions-contextual-trigger .delete&quot;).toggle();
				$listObjects.find(&quot;.actions-contextual-selection&quot;).toggle();

				if ($listObjects.find(&quot;.actions-contextual-selection&quot;).is(&quot;:visible&quot;)) {
					this.actionSelectorsUpdate(collName);
					/**
					* To make objects subviews show/hide their checkbox
					* @event browser:actions:toggle-checkboxes:[collName]
					*/
					channel.trigger(&quot;browser:actions:toggle-checkboxes:&quot;+collName);
				}
			},

			/**
			 * Triggers an event, which will be heard by sub-views that will actually execute the action
			 * 
			 * @method actionDeleteToggle
			 */
			actionExecute: function (event) {
				var $listObjects = $(event.target).closest(&quot;.listobjects&quot;);
				var collName     = $listObjects.hasClass(&quot;notes&quot;) ? &quot;notes&quot; : ($listObjects.hasClass(&quot;tags&quot;) ? &quot;tags&quot; : &quot;tasks&quot;);
				var action       = $(event.target).attr(&#x27;class&#x27;);// Which action do we want to trigger ?

				/**
				* To make objects subviews kill themselves and destroy their model if they are selected
				* @event browser:actions:delete:[collName]
				*/
				channel.trigger(&quot;browser:actions:delete:&quot;+collName);
			},


			// Search business objets in database
			// =============================================================================

			/**
			 * Checks whether the user is currently using a search input and if so tells which collection is visible
			 * 
			 * @method searchGetFocus
			 * @return {object} Returns the name of the collection studied (example : &#x60;notes&#x60;) or &#x60;false&#x60; if no search input has focus
			 */
			searchGetFocus: function () {
				var $listObjects;
				var sColl1;
				this.$(&quot;.super-input&quot;).find(&#x27;input&#x27;).each(function(idx,el) {
					if ($(el).is(&quot;:focus&quot;)) {
						$listObjects = $(el).closest(&#x27;.listobjects&#x27;);
						sColl1 = $listObjects.hasClass(&#x27;notes&#x27;) ? &#x27;notes&#x27; : ($listObjects.hasClass(&#x27;tags&#x27;) ? &#x27;tags&#x27; : &#x27;tasks&#x27;); //common
						return sColl1;
					}
				});
				return false;
			},

			/**
			 * Will prepare and open an autocomplete input.
			 * It should help the user selecting objects from collection named &#x60;sColl2&#x60; (example : &#x60;tags&#x60;) 
			 * that will then be used to filter the objects from collection named &#x60;sColl1&#x60;
			 *
			 * @method searchOpenAutocomplete
			 * @param sColl2 the name of the collection (example : &#x60;tags&#x60;) used to filter the collection currently displayed in browser
			 */
			searchOpenAutocomplete: function (sColl2) {
				// Check focus before taking action
				var self = this;
				var sColl1 = this.searchGetFocus(); // the kind of object we are filtering now
				if (sColl1 === false) { return; }

				var $listObjects = this.$(&quot;.listobjects.&quot;+sColl1);
				var sColl1Filter = sColl1.replace(/(s)$/, function($1){ return &quot;&quot;; })+&quot;Filter&quot;;

				// Parameter the autocomplete to propose the right kind of objects
				$listObjects.find(&quot;.search-wrapper .autocomplete&quot;).autocomplete({
					source: function (request, response) {
						// request.term : data typed in by the user (&quot;new yor&quot;)
						// response : native callback that must be called with the data to suggest to the user
						var oColl2Filter = (sColl2 == &quot;tasks&quot;) ? new TaskFilter ({text: request.term}) : new TagFilter ({text: request.term});

						response (
							self.options.collections[sColl2].search(oColl2Filter).map(function (model, key, list) {
								return {
									label: model.get(&quot;label&quot;),
									value: model.cid
								};
							})
						);
					},
					focus: function( event, ui ) {
						$(event.target).val(ui.item.label);
						return false; // to cancel normal behaviour
					},
					select: function(event, ui) {
						$(event.target).hide();
						$listObjects.find(&quot;.search&quot;).focus();

						// Saving input value into the global filter
						var mSelection = temp.coll[sColl2].get(ui.item.value) // ui.item.value == model.cid
						if (self.filters[sColl1Filter].get(sColl2).contains(mSelection) !== true) { 
							self.filters[sColl1Filter].get(sColl2).add(mSelection);
						}
					}
				// Change the autocomplete&#x27;s placeholder, empty it (in case it was used before), display it and focus in
				}).attr(&quot;placeholder&quot;,&quot;filter by related &quot;+sColl2).val(&#x27;&#x27;).show().focus(); 
			},

			searchCloseAutocomplete: function (event) {
				// Check focus before taking action
				var browserActiveView = this.searchGetFocus(); // the kind of object we are looking for
				if (browserActiveView === false) { return; }
				var $listObjects = this.$(&quot;.listobjects.&quot;+browserActiveView);
				// Listening to &quot;backspace&quot; &amp; &quot;escape&quot; events triggered by mousetrap
				if ( event == &quot;escape&quot; || (event == &quot;backspace&quot; &amp;&amp; $listObjects.find(&quot;.search-wrapper .autocomplete&quot;).val() == &#x27;&#x27;) ) {
					console.log(&quot;Closing autocomplete&quot;);
					$listObjects.find(&quot;.search-wrapper .autocomplete&quot;).hide();
					$listObjects.find(&quot;.search-wrapper .search&quot;).focus();
				}
			},

			searchObjectRemove: function (event) {
				var $objectButton          = $(event.target);
				var $listObjects           = $objectButton.closest(&#x27;.listobjects&#x27;);
				var filteredColl           = $listObjects.hasClass(&#x27;notes&#x27;) ? &#x27;notes&#x27; : ($listObjects.hasClass(&#x27;tags&#x27;) ? &#x27;tags&#x27; : &#x27;tasks&#x27;);
				var filteredCollFilterName = filteredColl.replace(/(s)$/, function($1){ return &quot;&quot;; })+&quot;Filter&quot;;
				var object                 = temp.coll[$objectButton.attr(&#x27;data-class&#x27;)].get($objectButton.attr(&#x27;data-cid&#x27;))
				this.filters[filteredCollFilterName].get($objectButton.attr(&#x27;data-class&#x27;)).remove(object); // Removing model from Filter
			},

			searchText: function (event) {
				var $listObjects = $(event.target).closest(&quot;.listobjects&quot;);
				var filterName   = $listObjects.hasClass(&quot;notes&quot;) ? &quot;noteFilter&quot; : ($listObjects.hasClass(&quot;tags&quot;) ? &quot;tagFilter&quot; : &quot;taskFilter&quot;);
				var collName     = $listObjects.hasClass(&quot;notes&quot;) ? &quot;notes&quot; : ($listObjects.hasClass(&quot;tags&quot;) ? &quot;tags&quot; : &quot;tasks&quot;);
				this.filters[filterName].set(&#x27;text&#x27;, $(event.target).val());
				this.renderCollection(collName);
				this.refreshFilterControls(collName.replace(/(s)$/, function($1){ return &quot;&quot;; }));
			},

			refreshFilterControls: function (collName) { //note
				var $listObjects    = this.$(&quot;.listobjects.&quot;+collName+&quot;s&quot;);
				var filtersCollName = collName+&quot;Filters&quot;;
				var filterName      = collName+&quot;Filter&quot;;

				$listObjects.find(&#x27;.filter-editor .action&#x27;).hide(); // No action controls should be displayed

				if (!this.filters[filterName].isEmpty()) { // The user has set a filter set in the super-input
					if (temp.coll[filtersCollName].containsSimilar(this.filters[filterName]) === false) {
						$listObjects.find(&#x27;.filter-editor .action.save&#x27;).show(); // &quot;Save&quot; button is displayed
					} else {
						$listObjects.find(&#x27;.filter-editor .action.delete&#x27;).show(); // &quot;Delete&quot; button is displayed
					}
				}
			},

			filterSaveStep1: function (event) {
				var $listObjects    = $(event.target).closest(&quot;.listobjects&quot;);
				$listObjects.find(&quot;.filter-editor input&quot;).show().focus();
				$listObjects.find(&#x27;.filter-editor .action.saveConfirm&#x27;).show();
				$listObjects.find(&#x27;.filter-editor .action.save&#x27;).hide();
			},

			filterSaveStep2: function (event) {
				var $listObjects    = $(event.target).closest(&quot;.listobjects&quot;);
				var filterName      = $listObjects.hasClass(&quot;notes&quot;) ? &quot;noteFilter&quot; : ($listObjects.hasClass(&quot;tags&quot;) ? &quot;tagFilter&quot; : &quot;taskFilter&quot;);
				var filtersCollName = filterName + &quot;s&quot;;
				var $inputFilterLabel = $listObjects.find(&quot;.filter-editor input&quot;);
				this.filters[filterName].set(&#x27;label&#x27;, $inputFilterLabel.val());
				$listObjects.find(&#x27;.filter-editor .action.saveConfirm&#x27;).hide();
				$inputFilterLabel.hide().val(&#x27;&#x27;);
				var cloneFilter = this.filters[filterName].superClone();
				temp.coll[filtersCollName].add(cloneFilter);
				cloneFilter.save();
			},

			filterDelete: function (event) {
				var $listObjects = $(event.target).closest(&quot;.listobjects&quot;);
				var filterName   = $listObjects.hasClass(&quot;notes&quot;) ? &quot;noteFilter&quot; : ($listObjects.hasClass(&quot;tags&quot;) ? &quot;tagFilter&quot; : &quot;taskFilter&quot;);
				/**
				* Event triggered on channel after the user decides to delete the saved tag
				* that is currently active. This event is listened by the views of 
				* the class {{#crossLink &quot;BrowserBodyFilterView&quot;}}{{/crossLink}}. The
				* one view related to a model with the right filter name will delete its model.
				* @event browser:filters:[filter-name]:remove-active
				*/
				channel.trigger(&quot;browser:filters:&quot;+filterName+&quot;:remove-active&quot;);
			},

			renderFilterCollection: function (filtersCollName) {
				var self         = this;
				var filteredColl = filtersCollName.replace(/(Filters)$/, function($1){ return &quot;s&quot;; }); // noteFilters =&gt; notes
				var filterName   = filtersCollName.replace(/(s)$/, function($1){ return &quot;&quot;; }); // noteFilters =&gt; noteFilter

				// First, emptying the DOM
				var $list = this.$(&#x27;.listobjects.&#x27;+filteredColl+&#x27; .filter-editor ul&#x27;);
				$list.html(&#x27;&#x27;);

				// Second, killing children views of right collection
				_.each(this.children[filtersCollName], function (child, index) {
					child.kill();
				});
				this.children[filtersCollName] = [];

				// Third, filling the DOM again
				temp.coll[filtersCollName].each(function (element) {
					var newView = new BrowserBodyFilterView({ filterName: filterName, model: element, parent: self });
					self.children[filtersCollName].push (newView);
					$list.append(newView.render().el);
				}, this);
			},

			renderFilterInSuperInput: function (filterName) {
				var self         = this;
				var filter       = this.filters[filterName];
				var filteredColl = filterName.replace(/(Filter)$/, function($1){ return &quot;s&quot;; }); // noteFilter =&gt; notes

				this.$(&quot;.listobjects.&quot;+filteredColl+&quot; .super-input .objectButtons span&quot;).remove();
				this.$(&quot;.listobjects.&quot;+filteredColl+&quot; .super-input input.search&quot;).val(filter.get(&#x27;text&#x27;)).focus();

				switch (filterName) {
					case &#x27;noteFilter&#x27;:
						filter.get(&#x27;tags&#x27;).each(function (tag) {
							var $objectButton = $(&quot;&lt;span&gt;&lt;/span&gt;&quot;)
								.attr(&#x27;data-class&#x27;, &quot;tags&quot;) //tags
								.attr(&#x27;data-cid&#x27;, tag.cid)
								.html(tag.get(&#x27;label&#x27;));
							self.$(&quot;.listobjects.&quot;+filteredColl+&quot; .super-input .objectButtons&quot;).append($objectButton);
						});
						filter.get(&#x27;tasks&#x27;).each(function (task) {
							var $objectButton = $(&quot;&lt;span&gt;&lt;/span&gt;&quot;)
								.attr(&#x27;data-class&#x27;, &quot;tasks&quot;) //tasks
								.attr(&#x27;data-cid&#x27;, task.cid)
								.html(task.get(&#x27;label&#x27;));
							self.$(&quot;.listobjects.&quot;+filteredColl+&quot; .super-input .objectButtons&quot;).append($objectButton);
						});
						break;
					case &#x27;taskFilter&#x27;:
						filter.get(&#x27;tags&#x27;).each(function (tag) {
							var $objectButton = $(&quot;&lt;span&gt;&lt;/span&gt;&quot;)
								.attr(&#x27;data-class&#x27;, &quot;tags&quot;) //tags
								.attr(&#x27;data-cid&#x27;, tag.cid)
								.html(tag.get(&#x27;label&#x27;));
							self.$(&quot;.listobjects.&quot;+filteredColl+&quot; .super-input .objectButtons&quot;).append($objectButton);
						});
						break;
				}
			},


			//=================================================================================
			// Render business objects&#x27; sub views 
			//=================================================================================
			render: function (event) {
				this.renderCollection(&#x27;notes&#x27;);
				this.renderCollection(&#x27;tags&#x27;);
				this.renderCollection(&#x27;tasks&#x27;);
			},

			renderCollection: function (collName) {
				var self = this;
				var filterName = collName == &quot;notes&quot; ? &quot;noteFilter&quot; : (collName == &quot;tasks&quot; ? &quot;taskFilter&quot; : &quot;tagFilter&quot;);

				// First, emptying the DOM
				var $list = this.$(&#x27;.listobjects.&#x27;+collName+&#x27; .&#x27;+collName);
				if ($list.is(&#x27;:ui-sortable&#x27;)) {
					$list.sortable( &quot;destroy&quot; );
				}
				$list.html(&#x27;&#x27;);

				// Second, killing children views of the right collection
				_.each(this.children[collName], function (child, index) {
					child.kill();
				});
				this.children[collName] = [];

				// Third, filling the DOM again
				var newView = {};
				var results = temp.coll[collName].search(this.filters[filterName]);

				results.each(function (element) {
					if (collName == &quot;notes&quot;) { newView = new BrowserBodyNoteView({ collName:&quot;notes&quot;, model: element }); }
					if (collName == &quot;tags&quot;) { newView = new BrowserBodyTagView({ collName:&quot;tags&quot;, model: element }); }
					if (collName == &quot;tasks&quot;) { newView = new BrowserBodyTaskView({ collName:&quot;tasks&quot;, model: element }); }
					self.children[collName].push (newView);
					$list.append(newView.render().el);
				}, this);

				if($list.hasClass(&#x27;tasks&#x27;)) {
					$list.sortable({
						update: function( event, ui ) {
							return self.sortableUpdate(event, ui);
						}
					});
				}
			},

			/**
			 * This methods aims at saving the new positions of the objects
			 * @param  {jQuery event} event http://api.jqueryui.com/sortable/#event-update the event triggered by jQuery
			 * @param  {jQuery ui} ui http://api.jqueryui.com/sortable/#event-update the ui object that is sortable
			 * @return {void} nothing to return
			 */
			sortableUpdate: function (event, ui) {
				console.log(&quot;sortable update&quot;);

				// 1. Find the model corresponding to the sorted DOM node
				var sortedModel = temp.coll.tasks.get(ui.item.attr(&#x27;data-cid&#x27;));
				// 2. Find out in which scenario we are
				if (!ui.item.next().length) { // The moved item is now the last one of the list (than could be filtered)
					var prevModel = temp.coll.tasks.get(ui.item.prev().attr(&#x27;data-cid&#x27;));
					sortedModel.set(&#x27;position&#x27;, prevModel.get(&#x27;position&#x27;)+1);
				} else { // The moved item is somewhere in the list
					var nextModel = temp.coll.tasks.get(ui.item.next().attr(&#x27;data-cid&#x27;));
					sortedModel.set(&#x27;position&#x27;, nextModel.get(&#x27;position&#x27;));
				}
				sortedModel.save();
				// 3. Shift all the following models
				temp.coll.tasks.shiftDown(sortedModel);
			}
		});

		return BrowserBodyView;
	}
);
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
